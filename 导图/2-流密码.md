# 应用密码学

## 第二章：流密码

### 基本概念

- 流密码

  利用密钥流进行加密
  密钥流：
  由密钥K和当前状态西格玛，组成函数f（k，西格玛），来产生一个密钥流。
  与状态有关，有记忆元件，一个个输出，每次的k要变

	- 同步流密码加密器

		- 密钥流产生器

		  看作是参数为k的，有限状态自动机
		  
		  采取非线性函数（抗密码分析）
		  
		  分为两部分：驱动系统（控制状态转移，提供统计性能好的序列）是一个或多个线性反馈寄存器
		  非线性组合系统（组合出满足要求的密钥流序列）

			- 初始状态
			- 状态集
			- 输出符号集
			- 状态转移函数Φ

			  将当前状态，转为新的状态
			  线性的

			- 输出函数	
ψ

			  当前状态变为输出符号集中的一个元素zi
			  
			  非线性的

		- 加密变换器

		  变换可逆
		  目前用二元加法流密码的密钥体系。

	- 有限状态自动机

	  离散输入输出的数学模型

		- 有限状态集
		- 有限输出、输入字符集
		- 转移函数

		  从某一状态转为另一状态
		  在某一状态下，输入为a，输出为b。结束输出后，转移为另一状态

- 分组密码

  与状态无关，无记忆元件，k不变

### 密码设计原则

- 长周期
- 高线性复杂度
- 统计性能良好
- 足够混乱
- 足够扩散
- 抵抗不同形式的攻击

### LSFR

- n级LSFR最大周期2^n  -1 

  n级线性反馈移位寄存器对应2的n次方个递推序列/初始状态，减去全零序列

### m序列

- 伪随机性

  由于密钥流是周期性的，所以序列不能做到完全随机。
  只要截获的序列比周期短时不会泄露信息，便为伪随机序列

	- 0、1在序列每一位置上出现概率相同
	- golomb随机性公设

		- 在序列的一个周期内，0、1相差个数最多为1

		  n长的m序列，一个周期内：
		  0出现次数:2^n-1   -1
		  1出现次数：2^n-1

		- 长为i的游程占总游程的2^i 分之一，等长游程中 0、1游程个数相等

		  n长的m序列，一个周期内：
		  总游程个数：2^n-1 
		  对于 1<= i <= n-2：长为i的游程有2^n-i-1 
		  且0、1各半； 长为n-1的0游程一个，为n的1游程一个

		- 异自相关函数是一个常数

	- 密码系统上，伪随机性需满足

		- 序列周期相当大
		- 知道部分密文和相应明文不能确定整个序列
		- 序列计算上容易

- 破译

  已知一段2n长的明密文对，可推出2n长的密钥序列。推出线性反馈移位寄存器n+1个连续状态

	- 状态单步递推关系 

	  S（h+1）= M·S（h）
	  
	  括号内表示下标
	  
	  
	  矩阵，根据S（h）可逆，矩阵求出M
	  
	  破译可以输出m序列的4级LSFR，获取连续2^n-1 个比特明文和密文串

### RC4算法

- 非线性序列

  输出序列的周期，不大于各驱动周期的乘积。
  提高线性复杂度，从极大化周期开始

- J-K触发器

  两个输入端，输入LFSR1和LFSR2，非线性序列生成器，产生驱动序列{ak}{bk}分别为m级和n级。输出ck
  m、n互素且a0+b0= 1时，序列{ck}
  周期（2^m   -1）(2^n    -1)
  
  但若知道ck相邻位ck-1和ck 就可以推断ak、bk中的一个，掌握足够多的该类信息，通过密码分析，便可得到ak、bk

- Pless生成器

  8个LSFR和4个JK触发器，1个循环计数器构成。循环计数器进行选通控制

- 钟控序列生成器

  用一个LSFR控制另一个LSFR的移位时钟脉冲

	- LSFR输出1，LSFR2进行一次位移，生成下一位
	- LSFR1输出0，LSFR2重复输出上一位
	- {Ck} 周期 (2^m  -1)(2^n   -1)  线性复杂度 n(2^m  -1)

- RC4算法

  RC4是基于非线性数组的变换序列密码，广泛应用于SSL保护因特网信息流

	- 特征

		- 用于安全套接字SSl和无线通信系统
		- 不基于LSFR，非线性变换

		  使用256字节大小的非线性数据表（S表），根据该表进行非线性变换，得到密钥流

		- 简单、高效、适用于软件实现，支持不同密钥长度

	- RC4实现

	  RC4  可看成有限状态自动机，S表和i、j索引的当前具体取值，成为一个状态。
	  S盒元素大小位1一个字节，
	  会有256! * 256^2种状态

		- S表初始化
		- 按步骤输出密钥流的一个字节z
		- 密钥调度算法KSA

		  数据表S被随机化
		  非线性数组变换的是S盒，长度为N=2^n 个元素，每n个元素，首先由密钥调度算法置乱初始排序

		- 伪随机数生成算法PRGA

		  输出密钥值：
		  生成随机密钥流序列，反复该过程直到生成的二进制数量等于明文位的数量
		  并且修改当前S的当前排列顺序

- A5算法

  基于线性反馈移位寄存器。

	- 保护从基站到移动设备传输的信息

	  GSM系统中主要使用的
	  GSM会话每帧含228比特
	  进行钟控，保证每次至少有两个LSFR被驱动移位（两个1以上时，1寄存器进动。两个0以上，0动）

*XMind: ZEN - Trial Version*